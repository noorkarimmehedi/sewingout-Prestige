{{ 'component-mobile-menu.css' | asset_url | stylesheet_tag }}

{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
HEADER SIDEBAR COMPONENT
----------------------------------------------------------------------------------------------------------------------

This snippet the navigation sidebar for the header. It is used for both the mobile menu and for the desktop menu when
the merchant configures the drawer mode.

********************************************
Supported variables
********************************************

* menu: the menu to render
* color_scheme: the color scheme to use for the sidebar
* show_dividers: whether dividers are shown for the collapsible
* open_second_level_menus: if true, second level dropdown are open by default
{%- endcomment -%}

{%- comment -%}
IMPLEMENTATION NOTE: while being a drawer, the sidebar has a completely different structure for the content. We are
therefore using a different structure for the Shadow DOM template
{%- endcomment -%}
<template id="header-sidebar-template">
  <div part="base">
    <div part="overlay"></div>

    <div part="content">
      <header part="header">
        <div class="header-sidebar__logo">
          {%- if section.settings.logo -%}
            {%- assign logo_width = section.settings.logo_mobile_max_width | times: 2 | at_most: section.settings.logo.width -%}
            <a href="{{ routes.root_url }}" class="header-sidebar__logo-link">
              <img src="{{ section.settings.logo | img_url: 'x40' }}" 
                   width="{{ logo_width }}"
                   height="{{ logo_width | divided_by: section.settings.logo.aspect_ratio | round }}"
                   alt="{{ section.settings.logo.alt | default: shop.name | escape }}"
                   loading="lazy">
            </a>
          {%- else -%}
            <a href="{{ routes.root_url }}" class="header-sidebar__logo-text h5">{{ shop.name }}</a>
          {%- endif -%}
        </div>
        <dialog-close-button class="contents">
          <button type="button" part="close-button tap-area" aria-label="{{ 'general.accessibility.close' | t | escape }}" class="header-sidebar__close-button">
            {%- render 'icon' with 'close', width: 20 -%}
          </button>
        </dialog-close-button>
      </header>

      <div part="panel-list" class="header-sidebar__panel-list">
        <slot name="main-panel"></slot>
        {%- if menu.levels > 0 -%}
          <slot name="collapsible-panel"></slot>
        {%- endif -%}
      </div>
    </div>
  </div>
</template>

<header-sidebar id="sidebar-menu" class="header-sidebar drawer drawer--sm color-scheme color-scheme--{{ color_scheme.id }}" template="header-sidebar-template" open-from="left">
  {%- comment -%}We are using a Shadow DOM where each panel has a slot, so we can directly render each level individually{%- endcomment -%}

  {%- comment -%}Panel 1 is the first level{%- endcomment -%}
  <div class="header-sidebar__main-panel" slot="main-panel">
    <div class="header-sidebar__scroller">
      <ul class="header-sidebar__linklist unstyled-list" role="list">
        {%- for link in menu.links -%}
          <li>
            {%- if link.links.size > 0 -%}
              <button type="button" class="header-sidebar__linklist-button" aria-controls="header-panel-{{ forloop.index }}" aria-expanded="false">
                <span class="header-sidebar__link-text">{{- link.title -}}</span>
                {%- render 'icon' with 'chevron-right', width: 14, direction_aware: true -%}
              </button>
            {%- else -%}
              <a href="{{ link.url }}" class="header-sidebar__linklist-button">
                <span class="header-sidebar__link-text">{{- link.title -}}</span>
              </a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
      
      {%- comment -%}Add a decorative element for the mobile menu{%- endcomment -%}
      <div class="header-sidebar__decorative">
        <div class="header-sidebar__decorative-line"></div>
        <div class="header-sidebar__decorative-accent"></div>
      </div>

    {%- liquid
      if section.settings.show_country_selector and localization.available_countries.size > 1
        assign show_country_selector = true
      endif

      if section.settings.show_locale_selector and localization.available_languages.size > 1
        assign show_locale_selector = true
      endif
    -%}

    {%- if shop.customer_accounts_enabled or show_country_selector or show_locale_selector -%}
      <div class="header-sidebar__footer">
        {%- if shop.customer_accounts_enabled -%}
          <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="header-sidebar__account-link">
            <span class="header-sidebar__account-icon">
              {%- render 'icon' with 'account', width: 20 -%}
            </span>
            <span class="header-sidebar__account-text">
              {%- if customer -%}
                {{- 'header.general.account' | t -}}
              {%- else -%}
                {{- 'header.general.login' | t -}}
              {%- endif -%}
            </span>
            <span class="header-sidebar__account-arrow">
              {%- render 'icon' with 'chevron-right', width: 12 -%}
            </span>
          </a>
        {%- endif -%}

        {%- if show_country_selector or show_locale_selector -%}
          <div class="localization-selectors">
            {%- if show_country_selector -%}
              {%- render 'localization-selector', 
                type: 'country', 
                placement: 'top-start', 
                show_country_name: section.settings.show_country_name, 
                show_country_flag: section.settings.show_country_flag, 
                id_prefix: 'header-sidebar',
                class: 'header-sidebar__localization'
              -%}
            {%- endif -%}

            {%- if show_country_selector and show_locale_selector -%}
              <span class="localization-selectors__separator" aria-hidden="true"></span>
            {%- endif -%}

            {%- if show_locale_selector -%}
              {%- render 'localization-selector', type: 'locale', placement: 'top-start', id_prefix: 'header-sidebar' -%}
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>

  {%- comment -%}Panel 2 holds all the second levels{%- endcomment -%}
  {%- if menu.levels > 0 -%}
    <header-sidebar-collapsible-panel class="header-sidebar__collapsible-panel" slot="collapsible-panel">
      <div class="header-sidebar__scroller">
        {%- for link in menu.links -%}
          {%- if link.links.size > 0 -%}
            <div id="header-panel-{{ forloop.index }}" class="header-sidebar__submenu" hidden>
              <button type="button" class="header-sidebar__back-button" data-action="close-panel">
                <span class="header-sidebar__back-icon">
                  {%- render 'icon' with 'chevron-left', width: 16 -%}
                </span>
                <span class="header-sidebar__back-text">{{- 'header.general.back' | t -}}</span>
              </button>

              <h2 class="header-sidebar__submenu-title">
                <span class="header-sidebar__submenu-title-text">{{ link.title | escape }}</span>
                <span class="header-sidebar__submenu-title-line"></span>
              </h2>

              <ul class="header-sidebar__submenu-list unstyled-list" role="list">
                {%- for child_link in link.links -%}
                  <li class="header-sidebar__submenu-item">
                    {%- if child_link.links.size > 0 -%}
                      <button type="button" class="header-sidebar__submenu-button" aria-controls="header-panel-{{ forloop.parentloop.index }}-{{ forloop.index }}" aria-expanded="false">
                        <span class="header-sidebar__submenu-text">{{- child_link.title -}}</span>
                        <span class="header-sidebar__submenu-icon">
                          {%- render 'icon' with 'chevron-right', width: 14 -%}
                        </span>
                      </button>
                    {%- else -%}
                      <a href="{{ child_link.url }}" class="header-sidebar__submenu-link">
                        <span class="header-sidebar__submenu-text">{{- child_link.title -}}</span>
                      </a>
                    {%- endif -%}
                  </li>
                {%- endfor -%}
              </ul>
                    assign mega_menu_block = block
                    break
                  endif

                endfor
              -%}

              {%- capture mega_menu_content -%}
                {%- render 'mega-menu-images', context: 'sidebar', block: mega_menu_block -%}
              {%- endcapture -%}

              {%- if mega_menu_content != blank -%}
                <div class="header-sidebar__promo scroll-area bleed md:unbleed">
                  {{- mega_menu_content -}}
                </div>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </header-sidebar-collapsible-panel>
  {%- endif -%}
</header-sidebar>